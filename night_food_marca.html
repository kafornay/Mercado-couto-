<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Editor de Imagens</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    canvas {
      max-width: 100%;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
    input, button {
      margin: 10px 0;
      width: 100%;
      padding: 10px;
    }
    img.preview {
      max-width: 100%;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>

  <h2>Editor de Imagem com Marca d'√Ågua</h2>

  <label>Imagem principal:</label>
  <input type="file" id="upload" accept="image/*" />

  <img id="previewImg" class="preview" />

  <label>Logo (opcional):</label>
  <input type="file" id="logoUpload" accept="image/*" />
  <img id="previewLogo" class="preview" />

  <label>Descri√ß√£o:</label>
  <input type="text" id="description" placeholder="Ex: Celular Samsung 128GB" />

  <label>Valor:</label>
  <input type="text" id="value" placeholder="Ex: 1.299,99" />

  <button onclick="generateImage()">Gerar Imagem com Marca d'√Ågua</button>
  <button onclick="copyDescription()">üìã Copiar Descri√ß√£o</button>

  <canvas id="canvas"></canvas>

  <script>
    const upload = document.getElementById('upload');
    const logoUpload = document.getElementById('logoUpload');
    const previewImg = document.getElementById('previewImg');
    const previewLogo = document.getElementById('previewLogo');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    upload.addEventListener('change', function () {
      const file = this.files[0];
      if (!file || !file.type.startsWith('image/')) {
        alert('Por favor, selecione uma imagem v√°lida.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        previewImg.src = e.target.result;
        previewImg.style.display = 'block';
      };
      reader.readAsDataURL(file);
    });

    logoUpload.addEventListener('change', function () {
      const file = this.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewLogo.src = e.target.result;
          previewLogo.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    function generateImage() {
      const description = document.getElementById('description').value.trim();
      const valor = document.getElementById('value').value.trim();

      const file = upload.files[0];
      if (!file) {
        alert('Selecione uma imagem antes de gerar.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const extraHeight = 60;
          canvas.width = img.width;
          canvas.height = img.height + extraHeight;

          ctx.drawImage(img, 0, 0);

          // Logo (se houver)
          const logoFile = logoUpload.files[0];
          if (logoFile) {
            const logoReader = new FileReader();
            logoReader.onload = function (event) {
              const logoImg = new Image();
              logoImg.onload = function () {
                const size = 100;
                ctx.drawImage(logoImg, canvas.width - size - 20, 20, size, size);
              };
              logoImg.src = event.target.result;
            };
            logoReader.readAsDataURL(logoFile);
          }

          // Descri√ß√£o e valor (sobre a imagem)
          ctx.font = 'bold 40px Poppins, sans-serif';
          ctx.fillStyle = '#f8b500';
          ctx.textAlign = 'center';

          const centerX = canvas.width / 2;
          const startY = 80;

          if (description) {
            ctx.fillText(description, centerX, startY);
          }

          if (valor) {
            ctx.fillStyle = '#28a745';
            ctx.fillText(`R$ ${valor}`, centerX, startY + 50);
          }

          // Faixa inferior para marca d‚Äô√°gua
          ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
          ctx.fillRect(0, img.height, canvas.width, extraHeight);

          // Marca d‚Äô√°gua
          ctx.font = 'bold 20px Roboto';
          ctx.fillStyle = 'white';
          ctx.textAlign = 'center';
          ctx.fillText('Minha Marca D\'√Ågua', canvas.width / 2, img.height + extraHeight / 2 + 7);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function copyDescription() {
      const text = document.getElementById('description').value.trim();
      if (!text) {
        alert('‚ö†Ô∏è Descri√ß√£o vazia.');
        return;
      }
      navigator.clipboard.writeText(text)
        .then(() => alert('‚úÖ Descri√ß√£o copiada!'))
        .catch(err => {
          alert('Erro ao copiar.');
          console.error(err);
        });
    }
  </script>
</body>
</html>
