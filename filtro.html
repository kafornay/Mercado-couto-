<!DOCTYPE html>

<html lang="pt-br">

<head>

Â  <meta charset="UTF-8" />

Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

Â  <title>Filtro de Melhores PreÃ§os com Quantidade</title>

Â  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

Â  <style>

Â  Â  body {

Â  Â  Â  font-family: 'Roboto', sans-serif;

Â  Â  Â  margin: 0;

Â  Â  Â  background: #f0f2f5;

Â  Â  Â  color: #333;

Â  Â  Â  line-height: 1.6;

Â  Â  }

Â  Â  .container {

Â  Â  Â  max-width: 960px;

Â  Â  Â  margin: 30px auto;

Â  Â  Â  background: white;

Â  Â  Â  padding: 25px;

Â  Â  Â  border-radius: 10px;

Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.08);

Â  Â  }

Â  Â  h2 {

Â  Â  Â  color: #1a2533;

Â  Â  Â  text-align: center;

Â  Â  Â  margin-bottom: 25px;

Â  Â  Â  font-weight: 700;

Â  Â  }

Â  Â  textarea {

Â  Â  Â  width: calc(100% - 22px);

Â  Â  Â  height: 150px;

Â  Â  Â  padding: 10px;

Â  Â  Â  font-size: 16px;

Â  Â  Â  border-radius: 6px;

Â  Â  Â  border: 1px solid #ced4da;

Â  Â  Â  resize: vertical;

Â  Â  Â  margin-bottom: 15px;

Â  Â  Â  transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;

Â  Â  }

Â  Â  textarea:focus {

Â  Â  Â  border-color: #007bff;

Â  Â  Â  box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);

Â  Â  Â  outline: none;

Â  Â  }

Â  Â  .input-actions {

Â  Â  Â  display: flex;

Â  Â  Â  gap: 10px;

Â  Â  Â  margin-bottom: 20px;

Â  Â  }

Â  Â  .input-actions button {

Â  Â  Â  background-color: #6c757d;

Â  Â  Â  color: white;

Â  Â  Â  padding: 10px 15px;

Â  Â  Â  border: none;

Â  Â  Â  border-radius: 5px;

Â  Â  Â  cursor: pointer;

Â  Â  Â  font-size: 14px;

Â  Â  Â  font-weight: 500;

Â  Â  Â  transition: background-color 0.2s ease;

Â  Â  }

Â  Â  .input-actions button:hover {

Â  Â  Â  background-color: #5a6268;

Â  Â  }

Â  Â  button {

Â  Â  Â  display: inline-block;

Â  Â  Â  padding: 12px 24px;

Â  Â  Â  margin: 5px;

Â  Â  Â  border: none;

Â  Â  Â  border-radius: 6px;

Â  Â  Â  background: #007bff;

Â  Â  Â  color: white;

Â  Â  Â  cursor: pointer;

Â  Â  Â  font-size: 16px;

Â  Â  Â  font-weight: 500;

Â  Â  Â  transition: background-color 0.2s ease, box-shadow 0.2s ease;

Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.05);

Â  Â  }

Â  Â  button:hover {

Â  Â  Â  background-color: #0056b3;

Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.1);

Â  Â  }

Â  Â  #adicionarBtn {}

Â  Â  button[onclick^="filtrarMelhoresPrecos"],

Â  Â  button[onclick^="verificarFaltantes"] {

Â  Â  Â  background-color: #28a745;

Â  Â  }

Â  Â  button[onclick^="filtrarMelhoresPrecos"]:hover,

Â  Â  button[onclick^="verificarFaltantes"]:hover {

Â  Â  Â  background-color: #1e7e34;

Â  Â  }

Â  Â  #listaCotacoes, #faltando, #resultado {

Â  Â  Â  margin-top: 20px;

Â  Â  Â  padding: 15px;

Â  Â  Â  border: 1px solid #e9ecef;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  background-color: #f8f9fa;

Â  Â  }

Â  Â  .item-card {

Â  Â  Â  background: #e9f7ef;

Â  Â  Â  border-left: 4px solid #28a745;

Â  Â  Â  padding: 12px 15px;

Â  Â  Â  margin-bottom: 10px;

Â  Â  Â  border-radius: 5px;

Â  Â  Â  font-size: 15px;

Â  Â  Â  color: #155724;

Â  Â  }

Â  Â  .fornecedor {

Â  Â  Â  background: #ffffff;

Â  Â  Â  border: 1px solid #dee2e6;

Â  Â  Â  padding: 20px;

Â  Â  Â  margin-bottom: 20px;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.05);

Â  Â  }

Â  Â  .fornecedor h3 {

Â  Â  Â  margin-top: 0;

Â  Â  Â  color: #007bff;

Â  Â  Â  margin-bottom: 15px;

Â  Â  Â  font-weight: 500;

Â  Â  Â  border-bottom: 1px solid #eee;

Â  Â  Â  padding-bottom: 10px;

Â  Â  }

Â  Â  .fornecedor ul {

Â  Â  Â  padding-left: 0;

Â  Â  Â  list-style-type: none;

Â  Â  }

Â  Â  .fornecedor li {

Â  Â  Â  padding: 10px 0;

Â  Â  Â  border-bottom: 1px dashed #e0e0e0;

Â  Â  Â  font-size: 15px;

Â  Â  Â  line-height: 1.5;

Â  Â  }

Â  Â  .fornecedor li:last-child {

Â  Â  Â  border-bottom: none;

Â  Â  }

Â  Â  /* Estilos para controles de item (quantidade, subtotal) */

Â  Â  .item-controles {

Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  gap: 10px;

Â  Â  Â  Â  margin-top: 8px;

Â  Â  Â  Â  margin-bottom: 8px;

Â  Â  }

Â  Â  .item-controles input[type="number"] {

Â  Â  Â  Â  width: 70px;

Â  Â  Â  Â  padding: 5px;

Â  Â  Â  Â  border-radius: 4px;

Â  Â  Â  Â  border: 1px solid #ced4da;

Â  Â  Â  Â  font-size: 14px;

Â  Â  }

Â  Â  .item-controles .subtotal-item {

Â  Â  Â  Â  font-weight: 500;

Â  Â  }

Â  Â  .total-pedido-fornecedor {

Â  Â  Â  Â  text-align: right;

Â  Â  Â  Â  font-weight: bold;

Â  Â  Â  Â  font-size: 1.1em;

Â  Â  Â  Â  margin-top: 15px;

Â  Â  Â  Â  padding-top: 10px;

Â  Â  Â  Â  border-top: 1px solid #eee;

Â  Â  }

Â  Â  .fornecedor li button.remover-item-btn { /* Classe especÃ­fica para botÃ£o de remover */

Â  Â  Â  Â  background-color: #dc3545;

Â  Â  Â  Â  color: white;

Â  Â  Â  Â  padding: 6px 10px;

Â  Â  Â  Â  font-size: 13px;

Â  Â  Â  Â  /* margin-top: 8px; */ /* Ajustado pelo flex container */

Â  Â  Â  Â  border-radius: 4px;

Â  Â  }

Â  Â  .fornecedor li button.remover-item-btn:hover {

Â  Â  Â  Â  background-color: #c82333;

Â  Â  }

Â  Â  .whatsapp {

Â  Â  Â  display: inline-block;

Â  Â  Â  margin-top: 15px;

Â  Â  Â  background: #25d366;

Â  Â  Â  color: white;

Â  Â  Â  padding: 10px 18px;

Â  Â  Â  border-radius: 20px;

Â  Â  Â  text-decoration: none;

Â  Â  Â  font-size: 15px;

Â  Â  Â  font-weight: 500;

Â  Â  Â  transition: background-color 0.2s ease, transform 0.2s ease;

Â  Â  }

Â  Â  .whatsapp:hover {

Â  Â  Â  background-color: #1da851;

Â  Â  Â  transform: translateY(-2px);

Â  Â  }

Â  Â  hr {

Â  Â  Â  Â  border: none;

Â  Â  Â  Â  border-top: 1px solid #dee2e6;

Â  Â  Â  Â  margin: 25px 0;

Â  Â  }

Â  Â  #semAlternativa h3 {

Â  Â  Â  Â  color: #dc3545;

Â  Â  Â  Â  font-size: 1.1em;

Â  Â  }

Â  Â  #semAlternativa ul li {

Â  Â  Â  Â  color: #555;

Â  Â  Â  Â  padding: 8px 0;

Â  Â  }

Â  </style>

</head>

<body>

Â  <div class="container">

Â  Â  <h2>Filtro de Melhores PreÃ§os com Quantidade</h2>

Â  Â  <textarea id="cotacao" placeholder="Cole aqui as cotaÃ§Ãµes..."></textarea>

Â  Â  <div class="input-actions">

Â  Â  Â  <button onclick="document.getElementById('cotacao').value = ''">Limpar</button>

Â  Â  Â  <button onclick="navigator.clipboard.readText().then(text => document.getElementById('cotacao').value = text).catch(err => console.error('Erro ao colar: ', err));">Colar</button>

Â  Â  </div>

Â  Â  <button id="adicionarBtn">Adicionar CotaÃ§Ã£o</button>

Â  Â  <div id="listaCotacoes"></div>

Â  Â  <hr />

Â  Â  <button onclick="filtrarMelhoresPrecos()">Filtrar Melhores PreÃ§os</button>

Â  Â  <button onclick="verificarFaltantes()">Verificar Itens Faltantes</button>

Â  Â  <div id="resultado"></div>

Â  Â  <div id="faltando"></div>

Â  </div>



Â  <script>

Â  Â  const cotacoes = [];

Â  Â  let todosPrecos = {};Â 

Â  Â  // ArmazenarÃ¡ os dados dos fornecedores para fÃ¡cil acesso e atualizaÃ§Ã£o das quantidades

Â  Â  // Estrutura: { "Nome Empresa": [{ nome, texto, valor, quantidade, ...}, ...], ... }

Â  Â  let dadosPedidosAtuais = {};Â 



Â  Â  document.getElementById('adicionarBtn').addEventListener('click', adicionarCotacao);



Â  Â  function adicionarCotacao() {

Â  Â  Â  const texto = document.getElementById('cotacao').value.trim();

Â  Â  Â  if (!texto) return;

Â  Â  Â  cotacoes.push(texto);

Â  Â  Â  const empresaMatch = texto.match(/\*Empresa:\* (.+)/);

Â  Â  Â  const nomeEmpresa = empresaMatch ? empresaMatch[1].trim() : 'Empresa nÃ£o identificada';

Â  Â  Â  const div = document.createElement('div');

Â  Â  Â  div.className = 'item-card';

Â  Â  Â  div.textContent = `CotaÃ§Ã£o de: ${nomeEmpresa}`;

Â  Â  Â  document.getElementById('listaCotacoes').appendChild(div);

Â  Â  Â  document.getElementById('cotacao').value = '';

Â  Â  }



Â  Â  function filtrarMelhoresPrecos() {

Â  Â  Â  const precosMap = new Map(); // Para encontrar o melhor preÃ§o inicial

Â  Â  Â  dadosPedidosAtuais = {};Â  Â  // Limpa os dados de pedidos anteriores

Â  Â  Â  todosPrecos = {};Â  Â  Â  Â  Â // Reinicializa para a nova filtragem



Â  Â  Â  cotacoes.forEach(txt => {

Â  Â  Â  Â  const empresaMatch = txt.match(/\*Empresa:\* (.+)/);

Â  Â  Â  Â  const empresa = empresaMatch ? empresaMatch[1].trim() : 'Desconhecida';

Â  Â  Â  Â  const itens = txt.split('ðŸ“¦').slice(1);



Â  Â  Â  Â  itens.forEach(bloco => {

Â  Â  Â  Â  Â  const linhas = bloco.trim().split('\n');

Â  Â  Â  Â  Â  const nomeMatch = linhas[0].match(/\*(.+)\*/);

Â  Â  Â  Â  Â  const nome = nomeMatch ? nomeMatch[1].toLowerCase().trim() : '';

Â  Â  Â  Â  Â  const valorMatch = linhas.find(l => l.includes('Valor unitÃ¡rio'))?.match(/R\$\s*([\d,.]+)/);

Â  Â  Â  Â  Â  const valor = valorMatch ? parseFloat(valorMatch[1].replace(/\./g, '').replace(',', '.')) : Infinity;

Â  Â  Â  Â  Â  if (!nome) return;



Â  Â  Â  Â  Â  if (!todosPrecos[nome]) {

Â  Â  Â  Â  Â  Â  todosPrecos[nome] = [];

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  todosPrecos[nome].push({ empresa, valor, texto: bloco.trim(), nomeOriginal: nomeMatch ? nomeMatch[1].trim() : nome });





Â  Â  Â  Â  Â  const melhorAtual = precosMap.get(nome);

Â  Â  Â  Â  Â  if (!melhorAtual || melhorAtual.valor > valor) {

Â  Â  Â  Â  Â  Â  // Armazena o preÃ§o unitÃ¡rio e o texto original do item

Â  Â  Â  Â  Â  Â  precosMap.set(nome, { valor, empresa, texto: bloco.trim(), nomeOriginal: nomeMatch ? nomeMatch[1].trim() : nome });

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  Â  });



Â  Â  Â  // Agrupa os melhores preÃ§os por fornecedor e adiciona quantidade e valor unitÃ¡rio

Â  Â  Â  precosMap.forEach((itemData, nomeProduto) => {

Â  Â  Â  Â  const { empresa, texto, valor, nomeOriginal } = itemData;

Â  Â  Â  Â  if (!dadosPedidosAtuais[empresa]) {

Â  Â  Â  Â  Â  dadosPedidosAtuais[empresa] = [];

Â  Â  Â  Â  }

Â  Â  Â  Â  // Adiciona o item ao fornecedor com quantidade 1 e o valor unitÃ¡rio

Â  Â  Â  Â  dadosPedidosAtuais[empresa].push({Â 

Â  Â  Â  Â  Â  Â  nome: nomeProduto, // nome em minÃºsculo para chaves

Â  Â  Â  Â  Â  Â  nomeOriginal: nomeOriginal, // nome como na cotaÃ§Ã£o para exibiÃ§Ã£o

Â  Â  Â  Â  Â  Â  textoOriginal: texto, // bloco completo da cotaÃ§Ã£o

Â  Â  Â  Â  Â  Â  valorUnitario: valor,Â 

Â  Â  Â  Â  Â  Â  quantidade: 1Â 

Â  Â  Â  Â  });

Â  Â  Â  });

Â  Â  Â  renderFornecedoresComQuantidade(dadosPedidosAtuais);

Â  Â  }

Â  Â Â 

Â  Â  function inicializarOuLimparSemAlternativa() {

Â  Â  Â  Â  let altDiv = document.getElementById('semAlternativa');

Â  Â  Â  Â  const resultadoDiv = document.getElementById('resultado');

Â  Â  Â  Â  if (!altDiv && resultadoDiv) {Â 

Â  Â  Â  Â  Â  Â  altDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  altDiv.id = 'semAlternativa';

Â  Â  Â  Â  Â  Â  altDiv.className = 'fornecedor';

Â  Â  Â  Â  Â  Â  altDiv.innerHTML = `<h3>Itens sem Fornecedor Alternativo</h3><ul></ul>`;

Â  Â  Â  Â  Â  Â  altDiv.style.display = 'none';Â 

Â  Â  Â  Â  Â  Â  resultadoDiv.appendChild(altDiv);

Â  Â  Â  Â  } else if (altDiv) {

Â  Â  Â  Â  Â  Â  const ul = altDiv.querySelector('ul');

Â  Â  Â  Â  Â  Â  if (ul) ul.innerHTML = '';Â 

Â  Â  Â  Â  Â  Â  altDiv.style.display = 'none';Â 

Â  Â  Â  Â  }

Â  Â  }



Â  Â  function renderFornecedoresComQuantidade(fornecedoresMap) {

Â  Â  Â  const resultadoDiv = document.getElementById('resultado');

Â  Â  Â  resultadoDiv.innerHTML = '';Â 



Â  Â  Â  Object.entries(fornecedoresMap).forEach(([empresa, itens]) => {

Â  Â  Â  Â  const divFornecedor = document.createElement('div');

Â  Â  Â  Â  divFornecedor.className = 'fornecedor';

Â  Â  Â  Â  divFornecedor.setAttribute('data-empresa', empresa);

Â  Â  Â  Â  divFornecedor.innerHTML = `<h3>${empresa}</h3><ul class="lista-itens-fornecedor"></ul>`;

Â  Â  Â  Â Â 

Â  Â  Â  Â  const ul = divFornecedor.querySelector('.lista-itens-fornecedor');



Â  Â  Â  Â  itens.forEach(item => {

Â  Â  Â  Â  Â  const nomeProdutoEscapado = item.nome.replace(/"/g, "&quot;").replace(/'/g, "&apos;");

Â  Â  Â  Â  Â  const empresaEscapada = empresa.replace(/'/g, "\\'");



Â  Â  Â  Â  Â  const li = document.createElement('li');

Â  Â  Â  Â  Â  li.setAttribute('data-produto-nome', item.nome); // Usar o nome normalizado para data attr



Â  Â  Â  Â  Â  // Apenas a primeira linha para o tÃ­tulo, o resto como detalhes.

Â  Â  Â  Â  Â  const linhasTextoOriginal = item.textoOriginal.split('\n');

Â  Â  Â  Â  Â  const tituloProduto = linhasTextoOriginal[0]; // Ex: *NOME DO PRODUTO*

Â  Â  Â  Â  Â  const detalhesCotacao = linhasTextoOriginal.slice(1).join('\n');





Â  Â  Â  Â  Â  li.innerHTML = `

Â  Â  Â  Â  Â  Â  <div class="item-descricao">

Â  Â  Â  Â  Â  Â  Â  Â  <strong>${tituloProduto.replace(/\n/g, '<br>')}</strong>

Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.9em; color: #666; margin-left: 5px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  ${detalhesCotacao.replace(/\n/g, '<br>')}

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="item-controles">

Â  Â  Â  Â  Â  Â  Â  Â  <span>PreÃ§o Unit.: R$ ${item.valorUnitario.toFixed(2)}</span>

Â  Â  Â  Â  Â  Â  Â  Â  <label for="qtd-${item.nome}-${empresa}">Qtd:</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="qtd-${item.nome}-${empresa}" class="quantidade-item"Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="${item.quantidade}" min="1"Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onchange="atualizarPedido('${empresaEscapada}', '${item.nome}', this.value)">

Â  Â  Â  Â  Â  Â  Â  Â  <span class="subtotal-item">Subtotal: R$ ${(item.valorUnitario * item.quantidade).toFixed(2)}</span>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button class="remover-item-btn" onclick="removerItem('${empresaEscapada}', '${item.nome}')">Remover item</button>

Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  ul.appendChild(li);

Â  Â  Â  Â  });



Â  Â  Â  Â  // Total do pedido e botÃ£o WhatsApp

Â  Â  Â  Â  const totalDiv = document.createElement('div');

Â  Â  Â  Â  totalDiv.className = 'total-pedido-fornecedor';

Â  Â  Â  Â  totalDiv.innerHTML = `Total do Pedido: <span class="valor-total-fornecedor">R$ 0.00</span>`;

Â  Â  Â  Â  divFornecedor.appendChild(totalDiv);



Â  Â  Â  Â  const whatsappLink = document.createElement('a');

Â  Â  Â  Â  whatsappLink.className = 'whatsapp';

Â  Â  Â  Â  whatsappLink.target = '_blank';

Â  Â  Â  Â  whatsappLink.textContent = 'Compartilhar via WhatsApp';

Â  Â  Â  Â  divFornecedor.appendChild(whatsappLink);

Â  Â  Â  Â Â 

Â  Â  Â  Â  resultadoDiv.appendChild(divFornecedor);

Â  Â  Â  Â  calcularTotaisEAtualizarWhatsapp(empresa); // Calcula total inicial e msg WhatsApp

Â  Â  Â  });

Â  Â  Â Â 

Â  Â  Â  inicializarOuLimparSemAlternativa();

Â  Â  }



Â  Â  function atualizarPedido(empresa, nomeProduto, novaQuantidade) {

Â  Â  Â  Â  novaQuantidade = parseInt(novaQuantidade, 10);

Â  Â  Â  Â  if (isNaN(novaQuantidade) || novaQuantidade < 1) {

Â  Â  Â  Â  Â  Â  novaQuantidade = 1; // Garante que a quantidade seja ao menos 1

Â  Â  Â  Â  Â  Â  // Opcional: atualizar o valor no input se foi corrigido

Â  Â  Â  Â  Â  Â  const inputQtd = document.getElementById(`qtd-${nomeProduto}-${empresa}`);

Â  Â  Â  Â  Â  Â  if(inputQtd) inputQtd.value = novaQuantidade;

Â  Â  Â  Â  }



Â  Â  Â  Â  const itemNoPedido = dadosPedidosAtuais[empresa]?.find(i => i.nome === nomeProduto);

Â  Â  Â  Â  if (itemNoPedido) {

Â  Â  Â  Â  Â  Â  itemNoPedido.quantidade = novaQuantidade;

Â  Â  Â  Â  }

Â  Â  Â  Â  calcularTotaisEAtualizarWhatsapp(empresa);

Â  Â  }



Â  Â  function calcularTotaisEAtualizarWhatsapp(empresa) {

Â  Â  Â  Â  const divFornecedor = document.querySelector(`.fornecedor[data-empresa="${empresa}"]`);

Â  Â  Â  Â  if (!divFornecedor) return;



Â  Â  Â  Â  const itensDoFornecedor = dadosPedidosAtuais[empresa] || [];

Â  Â  Â  Â  let totalPedido = 0;

Â  Â  Â  Â  let mensagemItensWhatsapp = [];



Â  Â  Â  Â  itensDoFornecedor.forEach(item => {

Â  Â  Â  Â  Â  Â  const subtotal = item.valorUnitario * item.quantidade;

Â  Â  Â  Â  Â  Â  totalPedido += subtotal;



Â  Â  Â  Â  Â  Â  // Atualiza o subtotal do item no DOM

Â  Â  Â  Â  Â  Â  const liItem = divFornecedor.querySelector(`li[data-produto-nome="${item.nome}"]`);

Â  Â  Â  Â  Â  Â  if (liItem) {

Â  Â  Â  Â  Â  Â  Â  Â  const subtotalSpan = liItem.querySelector('.subtotal-item');

Â  Â  Â  Â  Â  Â  Â  Â  if (subtotalSpan) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtotalSpan.textContent = `Subtotal: R$ ${subtotal.toFixed(2)}`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Formata a linha do item para o WhatsApp

Â  Â  Â  Â  Â  Â  mensagemItensWhatsapp.push(

Â  Â  Â  Â  Â  Â  Â  Â  `${item.quantidade}x ${item.nomeOriginal} - R$ ${item.valorUnitario.toFixed(2)} (Subtotal: R$ ${subtotal.toFixed(2)})`

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  });



Â  Â  Â  Â  // Atualiza o total do pedido no DOM

Â  Â  Â  Â  const totalSpan = divFornecedor.querySelector('.valor-total-fornecedor');

Â  Â  Â  Â  if (totalSpan) {

Â  Â  Â  Â  Â  Â  totalSpan.textContent = `R$ ${totalPedido.toFixed(2)}`;

Â  Â  Â  Â  }



Â  Â  Â  Â  // Atualiza o link do WhatsApp

Â  Â  Â  Â  const whatsappLink = divFornecedor.querySelector('.whatsapp');

Â  Â  Â  Â  if (whatsappLink) {

Â  Â  Â  Â  Â  Â  const msgFinalWhatsapp = `Pedido ${empresa}:\n` +

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mensagemItensWhatsapp.join('\n') +

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `\n\nTOTAL DO PEDIDO: R$ ${totalPedido.toFixed(2)}`;

Â  Â  Â  Â  Â  Â  whatsappLink.href = `https://wa.me/?text=${encodeURIComponent(msgFinalWhatsapp)}`;

Â  Â  Â  Â  }

Â  Â  }

Â  Â Â 

Â  Â  function removerItem(empresaOriginal, nomeProduto) {

Â  Â  Â  Â  // Remove o item da estrutura de dados interna

Â  Â  Â  Â  if (dadosPedidosAtuais[empresaOriginal]) {

Â  Â  Â  Â  Â  Â  dadosPedidosAtuais[empresaOriginal] = dadosPedidosAtuais[empresaOriginal].filter(i => i.nome !== nomeProduto);

Â  Â  Â  Â  }



Â  Â  Â  Â  // Remove o item do DOM

Â  Â  Â  Â  const blocoItemDOM = document.querySelector(`.fornecedor[data-empresa='${empresaOriginal}'] li[data-produto-nome='${nomeProduto}']`);

Â  Â  Â  Â  if (blocoItemDOM) {

Â  Â  Â  Â  Â  Â  const fornecedorDivOriginalDOM = blocoItemDOM.closest('.fornecedor');

Â  Â  Â  Â  Â  Â  blocoItemDOM.remove();

Â  Â  Â  Â  Â  Â  if (!dadosPedidosAtuais[empresaOriginal] || dadosPedidosAtuais[empresaOriginal].length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  fornecedorDivOriginalDOM.remove();

Â  Â  Â  Â  Â  Â  Â  Â  delete dadosPedidosAtuais[empresaOriginal]; // Limpa se nÃ£o hÃ¡ mais itens

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  calcularTotaisEAtualizarWhatsapp(empresaOriginal); // Recalcula para o fornecedor original

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // Tenta realocar o item

Â  Â  Â  Â  const alternativas = (todosPrecos[nomeProduto] || [])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(p => p.empresa !== empresaOriginal && (!dadosPedidosAtuais[p.empresa] || !dadosPedidosAtuais[p.empresa].find(item => item.nome === nomeProduto)))

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => a.valor - b.valor);



Â  Â  Â  Â  if (alternativas.length > 0) {

Â  Â  Â  Â  Â  Â  const novaMelhorAlternativa = alternativas[0];

Â  Â  Â  Â  Â  Â  if (!dadosPedidosAtuais[novaMelhorAlternativa.empresa]) {

Â  Â  Â  Â  Â  Â  Â  Â  dadosPedidosAtuais[novaMelhorAlternativa.empresa] = [];

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  dadosPedidosAtuais[novaMelhorAlternativa.empresa].push({

Â  Â  Â  Â  Â  Â  Â  Â  nome: nomeProduto, // nome normalizado

Â  Â  Â  Â  Â  Â  Â  Â  nomeOriginal: novaMelhorAlternativa.nomeOriginal, // nome para exibiÃ§Ã£o

Â  Â  Â  Â  Â  Â  Â  Â  textoOriginal: novaMelhorAlternativa.texto,

Â  Â  Â  Â  Â  Â  Â  Â  valorUnitario: novaMelhorAlternativa.valor,

Â  Â  Â  Â  Â  Â  Â  Â  quantidade: 1 // Adiciona com quantidade 1

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Re-renderiza todos ou apenas adiciona/atualiza o fornecedor alternativo

Â  Â  Â  Â  Â  Â  // Para simplificar, podemos re-renderizar tudo se a lÃ³gica de adicionar dinamicamente for complexa

Â  Â  Â  Â  Â  Â  // Ou, de forma mais otimizada, criar o card do novo fornecedor se nÃ£o existir e adicionar o item

Â  Â  Â  Â  Â  Â  renderFornecedoresComQuantidade(dadosPedidosAtuais); // Re-renderiza para refletir a mudanÃ§a

Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  const semAltUl = document.querySelector('#semAlternativa ul');

Â  Â  Â  Â  Â  Â  if (semAltUl) {Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const itemOriginalDados = todosPrecos[nomeProduto]?.find(p => p.empresa === empresaOriginal); // Encontra o item original

Â  Â  Â  Â  Â  Â  Â  Â  const itemOriginalTextoCompleto = itemOriginalDados ? itemOriginalDados.texto : nomeProduto;

Â  Â  Â  Â  Â  Â  Â  Â  const itemLi = document.createElement('li');

Â  Â  Â  Â  Â  Â  Â  Â  itemLi.innerHTML = `${itemOriginalTextoCompleto.replace(/\n/g, '<br>')} <i>(Originalmente com ${empresaOriginal}, sem alternativa encontrada)</i>`;

Â  Â  Â  Â  Â  Â  Â  Â  semAltUl.appendChild(itemLi);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  const semAlternativaDiv = document.getElementById('semAlternativa');

Â  Â  Â  Â  if(semAlternativaDiv && semAlternativaDiv.querySelector('ul li') === null){

Â  Â  Â  Â  Â  Â  semAlternativaDiv.style.display = 'none';

Â  Â  Â  Â  } else if (semAlternativaDiv) {

Â  Â  Â  Â  Â  Â  semAlternativaDiv.style.display = 'block';

Â  Â  Â  Â  }

Â  Â  }

Â  Â Â 

Â  Â  async function verificarFaltantes() {

Â  Â  Â  const faltandoDiv = document.getElementById('faltando');

Â  Â  Â  faltandoDiv.innerHTML = '<p>Verificando itens faltantes...</p>';

Â  Â  Â  const nomesCotados = new Set();

Â  Â  Â  cotacoes.forEach(txt => {

Â  Â  Â  Â  const itens = txt.split('ðŸ“¦').slice(1);

Â  Â  Â  Â  itens.forEach(bloco => {

Â  Â  Â  Â  Â  const nomeMatch = bloco.trim().split('\n')[0].match(/\*(.+)\*/);

Â  Â  Â  Â  Â  if (nomeMatch) nomesCotados.add(nomeMatch[1].toLowerCase().trim());

Â  Â  Â  Â  });

Â  Â  Â  });

Â  Â  Â  try {

Â  Â  Â  Â  const response = await fetch("https://script.google.com/macros/s/AKfycbxLJAKDj6xrk2pZK2Kst6hGKQZO4OAXx9ZKZIzuT3Qs1Oxv1fKsbpFTQKWTLkLd7DtA7A/exec");

Â  Â  Â  Â  const dados = await response.json();

Â  Â  Â  Â  const esperados = dados.map(item => item.produto?.toLowerCase().trim()).filter(Boolean);

Â  Â  Â  Â  const naoRespondidos = esperados.filter(prod => !nomesCotados.has(prod));

Â  Â  Â  Â  if (naoRespondidos.length > 0) {

Â  Â  Â  Â  Â  Â  faltandoDiv.innerHTML = `<h3>Itens ainda nÃ£o cotados (da lista de referÃªncia):</h3><ul>${naoRespondidos.map(n => `<li>${n}</li>`).join('')}</ul>`;

Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  faltandoDiv.innerHTML = `<h3>Itens ainda nÃ£o cotados (da lista de referÃªncia):</h3><ul><li>ðŸŽ‰ Todos os itens da lista de referÃªncia foram respondidos!</li></ul>`;

Â  Â  Â  Â  }

Â  Â  Â  } catch (e) {

Â  Â  Â  Â  faltandoDiv.innerHTML = '<p>Erro ao buscar dados da planilha de referÃªncia.</p>';

Â  Â  Â  Â  console.error(e);

Â  Â  Â  }

Â  Â  }



Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  const resultadoDiv = document.getElementById('resultado');

Â  Â  Â  Â  if (resultadoDiv && !document.getElementById('semAlternativa')) {

Â  Â  Â  Â  Â  Â  inicializarOuLimparSemAlternativa();

Â  Â  Â  Â  }

Â  Â  });



Â  </script>

</body>

</html>
